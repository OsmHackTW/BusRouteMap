/*! TainanBusMap 2014-10-22 */
function CreateBusMap(a){RouteDownloadManager=new L.TainanBus.RenderManager,map=L.map("map").setView([23.1852,120.4287],11),L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{attribution:MapAttribution}).addTo(map),GetRouteByCode(a)}function GetRouteByCode(a){var b=[];$.getJSON(categoryJsonUrl+routeJsonExtension,function(c){$.each(c,function(a,c){RouteDownloadManager.InitStopIconOption(c.categoryIndex);var d={MainLineColor:c.categoryLineColor,ExtendLineColor:c.categoryLineColor2};b.push(d)});var d,e,f={};$.getJSON(AllRoutesJsonUrl+routeJsonExtension,function(c){$.each(c,function(b,c){return a==c.RouteCodeName?(d=c.RouteCategory,e=c.RouteOSMRelation,!1):void 0}),void 0===d&&void 0===e?window.alert("編號不存在!"):(f=b[d-1],RouteDownloadManager.InitLeafletOption(d,f),map.addControl(new L.BusDirControl(e)),$('input[name="direction"]:radio').change(function(){SetSelectDirection2(e)}))})})}function SetSelectDirection2(a){var b=$('input[name="dirctions"]:checked').val();"forward"==b?RouteDownloadManager.DownloadRouteMaster(a,!0,DivString):RouteDownloadManager.DownloadRouteMaster(a,!1,DivString)}var AllRoutesJsonUrl="LocalData/AllBusRoutes",RouteDownloadManager,DivString="#map";$(document).ready(function(){var a=$(DivString);return void 0===a||void 0===a.attr("bus-ref")?void window.alert("找不到地圖Div或編號不存在!"):void CreateBusMap(a.attr("bus-ref"))}),L.BusDirControl=L.Control.extend({options:{position:"topright"},initialize:function(a,b){L.Util.setOptions(this,b),this._busRelationID=a},onAdd:function(){var a='<input type="radio" name="direction" value="forward" checked>往程<br/>',b='<input type="radio" name="direction" value="backward">返程',c=L.DomUtil.create("div","dir");return $(c).append(a,b),SetSelectDirection2(this._busRelationID),c},onRemove:function(){}});