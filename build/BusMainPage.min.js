/*! BusRouteMap 2016-01-11 */
function InitCategories(){MainPageVars.RouteDownloadManager=new L.Bus.RenderManager,$.getJSON(CommonVars.CategoryJsonUrl+CommonVars.JsonExtension,function(a){var b=$("#SelectCategory").empty();$.each(a,function(a,c){b.append($("<option></option>").text(c.categoryName).attr("value",c.categoryOSMRef)),MainPageVars.RouteDownloadManager.InitStopIconOption(c.categoryOSMRef,c.colourScheme),MainPageVars.ColorSchemeCollect[c.categoryOSMRef]=c.colourScheme}),$("#SelectCategory").selectpicker("refresh"),SetRoutesList("CityBus")})}function ChangeCategory(){var a=$("#SelectCategory option:selected").attr("value");void 0!==a&&SetRoutesList(a)}function SetRoutesList(a){var b=$("#SelectRoute").empty();MainPageVars.CurrentColorScheme=MainPageVars.ColorSchemeCollect[a],MainPageVars.RouteDownloadManager.InitLeafletOption(a,MainPageVars.CurrentColorScheme),$.getJSON(MainPageVars.RouteJsonUrl+a+CommonVars.JsonExtension,function(a){$.each(a,function(a,c){b.append($("<option></option>").text(c.RouteName).attr("value",c.RouteOSMRelation+","+c.RouteCode).attr("label",c.RouteFromTo))}),$("#SelectRoute").selectpicker("refresh"),SetSelectedRoute()})}function SetSelectedRoute(){var a,b=$("#RouteDes").empty();a=$("#SelectRoute option:selected").attr("label");var c=$("#SelectRoute option:selected").attr("value");MainPageVars.CurrentSelectedRouteArray=c.split(","),void 0!==a&&void 0!==b&&(b.text(a),SetSelectDirection())}function SetSelectDirection(){var a=$('input[name="dirctions"]:checked').val();MainPageVars.RouteDownloadManager.DownloadRouteMaster(MainPageVars.CurrentSelectedRouteArray[0],a,null)}function QueryRealtimeBus(){var a=$("#codeID").text();window.open(CommonVars.ConfigObject.BusStopRealTimeUrl+a,a)}var MainPageVars={RouteDownloadManager:void 0,CurrentSelectedRouteArray:[],CurrentColorScheme:void 0,ColorSchemeCollect:{},RouteJsonUrl:"LocalData/BusRoute_"};$(document).ready(function(){CommonVars.InitConfig(),CommonVars.MapObject=L.map("map").setView([23.1852,120.4287],11),$("select").selectpicker(),L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{attribution:CommonVars.MapAttribution}).addTo(CommonVars.MapObject),InitCategories(),$("#SelectCategory").change(function(){ChangeCategory()}),$("#SelectRoute").change(function(){SetSelectedRoute()}),$('input[name="dirctions"]:radio').change(function(){SetSelectDirection()}),$("#Info_toggle").click(function(a){a.preventDefault(),window.open(CommonVars.ConfigObject.BusRouteInfoUrl+MainPageVars.CurrentSelectedRouteArray[1],MainPageVars.CurrentSelectedRouteArray[1])})});