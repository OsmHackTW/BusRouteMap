/*! TainanBusMap 2015-09-06 */
function InitCategories(){RouteDownloadManager=new L.TainanBus.RenderManager,$.getJSON(categoryJsonUrl+routeJsonExtension,function(a){var b=$("#SelectCategory").empty();$.each(a,function(a,c){b.append($("<option></option>").text(c.categoryName).attr("value",c.categoryIndex)),RouteDownloadManager.InitStopIconOption(c.categoryIndex);var d={MainLineColor:c.categoryLineColor,ExtendLineColor:c.categoryLineColor2};ColorSchemeCollect.push(d)}),$("#SelectCategory").selectpicker("refresh"),SetRoutesList(1)})}function ChangeCategory(){var a=$("#SelectCategory option:selected").attr("value");void 0!==a&&SetRoutesList(a)}function SetRoutesList(a){var b=$("#SelectRoute").empty();currentColorScheme=ColorSchemeCollect[a-1],RouteDownloadManager.InitLeafletOption(a,currentColorScheme),$.getJSON(routeJsonUrl+a+routeJsonExtension,function(a){$.each(a,function(a,c){b.append($("<option></option>").text(c.RouteName).attr("value",c.RouteOSMRelation+","+c.RouteCode).attr("label",c.RouteFromTo))}),$("#SelectRoute").selectpicker("refresh"),SetSelectedRoute()})}function SetSelectedRoute(){var a,b=$("#RouteDes").empty();a=$("#SelectRoute option:selected").attr("label");var c=$("#SelectRoute option:selected").attr("value");currentSelectedRouteArray=c.split(","),void 0!==a&&void 0!==b&&(b.text(a),SetSelectDirection())}function SetSelectDirection(){var a=$('input[name="dirctions"]:checked').val();RouteDownloadManager.DownloadRouteMaster(currentSelectedRouteArray[0],a,null)}function QueryRealtimeBus(){var a=$("#codeID").text();window.open(RealtimeBusURL+a,a)}var routeJsonUrl="LocalData/BusRoute",currentSelectedRouteArray,currentColorScheme,ColorSchemeCollect=[],RouteDownloadManager;$(document).ready(function(){map=L.map("map").setView([23.1852,120.4287],11),$("select").selectpicker(),L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{attribution:MapAttribution}).addTo(map),InitCategories(),$("#SelectCategory").change(function(){ChangeCategory()}),$("#SelectRoute").change(function(){SetSelectedRoute()}),$('input[name="dirctions"]:radio').change(function(){SetSelectDirection()}),$("#Info_toggle").click(function(a){a.preventDefault(),window.open(routeInfoUrl+currentSelectedRouteArray[1],currentSelectedRouteArray[1])})});